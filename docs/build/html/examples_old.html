<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Examples &#8212; PyLumerical 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=2709fde1"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h1>
<section id="d-fabry-perot-open-access-optical-microcavity">
<h2>3D Fabry-Perot Open-Access Optical Microcavity<a class="headerlink" href="#d-fabry-perot-open-access-optical-microcavity" title="Link to this heading">¶</a></h2>
<section id="building-the-simulation-file">
<h3>Building the Simulation File<a class="headerlink" href="#building-the-simulation-file" title="Link to this heading">¶</a></h3>
<p>The full example code for building the geometry can be found <a class="reference internal" href="example1_geometry.html"><span class="doc">here</span></a></p>
<p>First, start by importing the necessary python libraries</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">imp</span>
<span class="c1"># import os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cavity</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">simulation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">source</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">monitor</span>
</pre></div>
</div>
<p>‘imp’ is a standard python library which allows us to import a local file. We need to link the main script to the
Lumerical python API file which is stored locally on our PC within the Lumerical folder. For example, the lumapi
may be found at the following address (depending on distribution).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># os.add_dll_directory(&quot;C:\\Program Files\\Lumerical\\v232\\api\\python\\&quot;)</span>
<span class="n">lumapi</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="s2">&quot;lumapi&quot;</span><span class="p">,</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Program Files</span><span class="se">\\</span><span class="s2">Lumerical</span><span class="se">\\</span><span class="s2">v232</span><span class="se">\\</span><span class="s2">api</span><span class="se">\\</span><span class="s2">python</span><span class="se">\\</span><span class="s2">lumapi.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Above, the <strong>os.add_dll_directory</strong> is only used if there is any difficulty adding the file.</p>
<p>We can choose whether or not to save the file, and asign a filename if necessary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;testrun.fsp&quot;</span>
</pre></div>
</div>
<p>The FDTD object from the lumapi now needs to be instantiated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fdtd</span> <span class="o">=</span> <span class="n">lumapi</span><span class="o">.</span><span class="n">FDTD</span><span class="p">()</span>
</pre></div>
</div>
<p>With this, we can access the necessary Lumerical methods. Now, we can begin building the simulation geometry.
We’ll start by providing some necessary constants:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wlen</span> <span class="o">=</span> <span class="mf">.637e-06</span> <span class="c1"># centre wavelength</span>
<span class="n">roc</span> <span class="o">=</span> <span class="mf">2e-06</span>     <span class="c1"># cavity radius of curvature</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">4</span>           <span class="c1"># cavity longitudinal mode index</span>
<span class="n">ncav</span> <span class="o">=</span> <span class="mi">1</span>        <span class="c1"># refractive index of cavity medium (1 if open-access)</span>
</pre></div>
</div>
<p>The Cavity() constructor now needs to be instantiated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cav</span> <span class="o">=</span> <span class="n">cavity</span><span class="o">.</span><span class="n">Cavity</span><span class="p">(</span><span class="n">roc</span><span class="o">=</span><span class="n">roc</span><span class="p">,</span> <span class="n">wlen</span><span class="o">=</span><span class="n">wlen</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">ncav</span><span class="o">=</span><span class="n">ncav</span><span class="p">,</span> <span class="n">rough</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fdtd</span><span class="o">=</span><span class="n">fdtd</span><span class="p">)</span>
<span class="n">cav</span><span class="o">.</span><span class="n">build_cavity</span><span class="p">(</span><span class="n">num_planar</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">num_feat</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n1</span><span class="o">=</span><span class="mf">2.21</span><span class="p">,</span> <span class="n">n2</span><span class="o">=</span><span class="mf">1.42</span><span class="p">,</span> <span class="n">nsub</span><span class="o">=</span><span class="mf">1.45</span><span class="p">,</span> <span class="n">Lsub</span><span class="o">=</span><span class="mf">20e-09</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
</pre></div>
</div>
<p>This will build a plano-convex cavity with a specified number of mirrors, indices, and substrate parameters.
It may be necessary, at the time being, to modify this specific specific method in the cavity.py library,
since this has not yet been fully developed.</p>
<p>To determine the dimensions of needed for the FDTD simulation region, we need to find the minimum and maximum
z-dimensions of the cavity geometry:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fdtd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;structure::planar mirror::substrate&#39;</span><span class="p">)</span>
<span class="n">Region_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">fdtd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z max&#39;</span><span class="p">)</span>
<span class="n">fdtd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;structure::featured mirror::substrate&#39;</span><span class="p">)</span>
<span class="n">Region_max</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fdtd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;z min&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">.5</span><span class="o">*</span><span class="n">wlen</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can create the FDTD region. Since the cavity geometry in this case is cyllindrically symmetric, we can
cut the simulation time by exploiting the symmetry, with Symmetric and Anti-Symmetric boundary conditions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">fdtd</span><span class="o">=</span><span class="n">fdtd</span><span class="p">,</span> <span class="n">xy_span_bleed</span><span class="o">=</span><span class="n">cav</span><span class="o">.</span><span class="n">xy_span_bleed</span><span class="p">,</span>
                        <span class="n">runtime</span><span class="o">=</span><span class="mf">3000e-15</span><span class="p">,</span> <span class="n">meshacc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">z_min</span><span class="o">=</span><span class="n">Region_min</span><span class="p">,</span>
                        <span class="n">z_max</span><span class="o">=</span><span class="n">Region_max</span><span class="p">)</span>

<span class="n">sim</span><span class="o">.</span><span class="n">fdtd_region</span><span class="p">(</span><span class="n">x_min_bc</span><span class="o">=</span><span class="s2">&quot;Symmetric&quot;</span><span class="p">,</span> <span class="n">y_min_bc</span><span class="o">=</span><span class="s2">&quot;Anti-Symmetric&quot;</span><span class="p">,</span> <span class="n">z_min_bc</span><span class="o">=</span><span class="s2">&quot;PML&quot;</span><span class="p">,</span>
                    <span class="n">dt_stab</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">fdtd_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">min_layers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">max_layers</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
                    <span class="n">autoshutoff</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">)</span>
</pre></div>
</div>
<p>Since the DBR mirror have small features, we need to capture the behaviour here more carefully. We can do this
with a seperate mesh for each mirror:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;planar mesh&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">0.01e-06</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mf">0.01e-06</span><span class="p">,</span> <span class="n">dz</span><span class="o">=</span><span class="mf">0.01e-06</span><span class="p">,</span>
            <span class="n">based_on_struct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">struct</span><span class="o">=</span><span class="s2">&quot;planar mirror&quot;</span><span class="p">)</span>

<span class="n">sim</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;feat mesh&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">0.01e-06</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mf">0.01e-06</span><span class="p">,</span> <span class="n">dz</span><span class="o">=</span><span class="mf">0.01e-06</span><span class="p">,</span>
            <span class="n">based_on_struct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">struct</span><span class="o">=</span><span class="s2">&quot;featured mirror&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can now add a source in the cavity. In this example we will use a dipole source:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">src</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">fdtd</span><span class="o">=</span><span class="n">fdtd</span><span class="p">,</span> <span class="n">wlen</span><span class="o">=</span><span class="n">wlen</span><span class="p">)</span>
<span class="n">src</span><span class="o">.</span><span class="n">dipole</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">emission_width</span><span class="o">=</span><span class="mf">100e-09</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pml_thickness</span> <span class="o">=</span> <span class="mf">0e-09</span>
<span class="n">xy_span_pml</span> <span class="o">=</span> <span class="n">cav</span><span class="o">.</span><span class="n">xy_span</span> <span class="o">+</span> <span class="n">pml_thickness</span>

<span class="n">mon</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">Monitor</span><span class="p">(</span><span class="n">fdtd</span><span class="o">=</span><span class="n">fdtd</span><span class="p">)</span>

<span class="n">apod_center</span> <span class="o">=</span> <span class="mf">0e-15</span>
<span class="n">apod_start_w</span> <span class="o">=</span> <span class="mf">100e-15</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mon</span><span class="o">.</span><span class="n">Q_monitor</span><span class="p">(</span><span class="n">Qmonitor_zspan</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Qmonitor_zlayer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">t_sample</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">dipole_shift</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mon</span><span class="o">.</span><span class="n">index_monitor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">monitor_type</span><span class="o">=</span><span class="s2">&quot;2D Y-normal&quot;</span><span class="p">,</span>
                    <span class="n">x_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                    <span class="n">z_min</span><span class="o">=</span><span class="n">Region_min</span><span class="o">-</span><span class="mf">.5</span><span class="o">*</span><span class="n">pml_thickness</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="n">Region_max</span> <span class="o">+</span> <span class="mf">.5</span><span class="o">*</span><span class="n">pml_thickness</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mon</span><span class="o">.</span><span class="n">power_monitor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;xy_exoplanar&#39;</span><span class="p">,</span> <span class="n">montype</span><span class="o">=</span><span class="s2">&quot;2D Z-normal&quot;</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">,</span>
                  <span class="n">x_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">y_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">z</span><span class="o">=</span><span class="n">Region_max</span><span class="p">,</span>
                  <span class="n">apod</span><span class="o">=</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">apod_center</span><span class="o">=</span><span class="n">apod_center</span><span class="p">,</span> <span class="n">apod_time_width</span><span class="o">=</span><span class="n">apod_start_w</span><span class="p">)</span>

<span class="n">mon</span><span class="o">.</span><span class="n">power_monitor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;xy_mid&#39;</span><span class="p">,</span> <span class="n">montype</span><span class="o">=</span><span class="s2">&quot;2D Z-normal&quot;</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">,</span>
                  <span class="n">x_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">y_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                  <span class="n">apod</span><span class="o">=</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">apod_center</span><span class="o">=</span><span class="n">apod_center</span><span class="p">,</span> <span class="n">apod_time_width</span><span class="o">=</span><span class="n">apod_start_w</span><span class="p">)</span>

<span class="n">mon</span><span class="o">.</span><span class="n">power_monitor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;xy_exofeatured&#39;</span><span class="p">,</span> <span class="n">montype</span><span class="o">=</span><span class="s2">&quot;2D Z-normal&quot;</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">,</span>
                  <span class="n">x_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">y_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">z</span><span class="o">=</span><span class="n">Region_min</span><span class="p">,</span>
                  <span class="n">apod</span><span class="o">=</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">apod_center</span><span class="o">=</span><span class="n">apod_center</span><span class="p">,</span> <span class="n">apod_time_width</span><span class="o">=</span><span class="n">apod_start_w</span><span class="p">)</span>

<span class="n">mon</span><span class="o">.</span><span class="n">power_monitor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;xz_middle&#39;</span><span class="p">,</span> <span class="n">montype</span><span class="o">=</span><span class="s2">&quot;2D Y-normal&quot;</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s2">&quot;xz&quot;</span><span class="p">,</span>
                  <span class="n">x_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">z_min</span><span class="o">=</span><span class="n">Region_min</span><span class="o">-</span><span class="n">pml_thickness</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="n">Region_max</span><span class="o">+</span><span class="n">pml_thickness</span><span class="p">,</span>
                  <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                  <span class="n">apod</span><span class="o">=</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">apod_center</span><span class="o">=</span><span class="n">apod_center</span><span class="p">,</span> <span class="n">apod_time_width</span><span class="o">=</span><span class="n">apod_start_w</span><span class="p">)</span>

<span class="n">mon</span><span class="o">.</span><span class="n">power_monitor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;xz_edge&#39;</span><span class="p">,</span> <span class="n">montype</span><span class="o">=</span><span class="s2">&quot;2D Y-normal&quot;</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s2">&quot;xz&quot;</span><span class="p">,</span>
                  <span class="n">x_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">z_min</span><span class="o">=</span><span class="n">Region_min</span><span class="o">-</span><span class="n">pml_thickness</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="n">Region_max</span><span class="o">+</span><span class="n">pml_thickness</span><span class="p">,</span>
                  <span class="n">y</span> <span class="o">=</span> <span class="mf">.5</span><span class="o">*</span><span class="n">cav</span><span class="o">.</span><span class="n">xy_span</span><span class="p">,</span>
                  <span class="n">apod</span><span class="o">=</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">apod_center</span><span class="o">=</span><span class="n">apod_center</span><span class="p">,</span> <span class="n">apod_time_width</span><span class="o">=</span><span class="n">apod_start_w</span><span class="p">)</span>

<span class="n">mon</span><span class="o">.</span><span class="n">power_monitor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;yz_middle&#39;</span><span class="p">,</span> <span class="n">montype</span><span class="o">=</span><span class="s2">&quot;2D X-normal&quot;</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s2">&quot;yz&quot;</span><span class="p">,</span>
                  <span class="n">y_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">z_min</span><span class="o">=</span><span class="n">Region_min</span><span class="o">-</span><span class="n">pml_thickness</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="n">Region_max</span><span class="o">+</span><span class="n">pml_thickness</span><span class="p">,</span>
                  <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                  <span class="n">apod</span><span class="o">=</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">apod_center</span><span class="o">=</span><span class="n">apod_center</span><span class="p">,</span> <span class="n">apod_time_width</span><span class="o">=</span><span class="n">apod_start_w</span><span class="p">)</span>

<span class="n">mon</span><span class="o">.</span><span class="n">power_monitor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;yz_edge&#39;</span><span class="p">,</span> <span class="n">montype</span><span class="o">=</span><span class="s2">&quot;2D X-normal&quot;</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="s2">&quot;yz&quot;</span><span class="p">,</span>
                  <span class="n">y_min</span><span class="o">=-</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">xy_span_pml</span><span class="p">,</span>
                  <span class="n">z_min</span><span class="o">=</span><span class="n">Region_min</span><span class="o">-</span><span class="n">pml_thickness</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="n">Region_max</span><span class="o">+</span><span class="n">pml_thickness</span><span class="p">,</span>
                  <span class="n">x</span><span class="o">=</span><span class="mf">.5</span><span class="o">*</span><span class="n">cav</span><span class="o">.</span><span class="n">xy_span</span><span class="p">,</span>
                  <span class="n">apod</span><span class="o">=</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="n">apod_center</span><span class="o">=</span><span class="n">apod_center</span><span class="p">,</span> <span class="n">apod_time_width</span><span class="o">=</span><span class="n">apod_start_w</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">save</span><span class="p">:</span>
    <span class="n">fdtd</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="n">fdtd</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="analysis">
<h3>Analysis<a class="headerlink" href="#analysis" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is still under heavy development. This analysis has been done well in Lumerical’s in-built
scripting language, but at present, I am porting this over to python in the most natural way I can. As a
result, this will take a bit of time to get fully finished.</p>
</div>
<p>As before, we start by importing the necessary libraries. this time, we need to import the cavityanalysis class,
which contains the required methods for calculating Quality Factor, Purcell Factor, Mode Volume, etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">imp</span>
<span class="c1"># import os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.constants</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cavityanalysis</span>
</pre></div>
</div>
<p>The FDTD object must be instantiated again:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># os.add_dll_directory(&quot;C:\\Program Files\\Lumerical\\v232\\api\\python\\&quot;)</span>
<span class="n">lumapi</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="s2">&quot;lumapi&quot;</span><span class="p">,</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Program Files</span><span class="se">\\</span><span class="s2">Lumerical</span><span class="se">\\</span><span class="s2">v232</span><span class="se">\\</span><span class="s2">api</span><span class="se">\\</span><span class="s2">python</span><span class="se">\\</span><span class="s2">lumapi.py&quot;</span><span class="p">)</span>

<span class="n">fdtd</span> <span class="o">=</span> <span class="n">lumapi</span><span class="o">.</span><span class="n">FDTD</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, the lumerical simulation file (.fsp) and data file (.ldf) must be loaded. These contain all of the simulation
structures and variables.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pdir</span> <span class="o">=</span> <span class="s1">&#39;&lt; DIRECTORY CONTAINING SIMULATION .FSP FILE &gt;&#39;</span>

<span class="n">fdtd</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pdir</span> <span class="o">+</span> <span class="s1">&#39;fsp.fsp&#39;</span><span class="p">)</span>
<span class="n">fdtd</span><span class="o">.</span><span class="n">loaddata</span><span class="p">(</span><span class="n">pdir</span> <span class="o">+</span> <span class="s1">&#39;lnp.ldf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We will need to extract information from the simulation monitors. We can get the monitor names using the FDTD
object, but since we already know the monitor names (since we defined them), we can make this easier by just assinging
the monitor variable names directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Monitor names</span>
<span class="n">m0</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
<span class="n">m1</span> <span class="o">=</span> <span class="s1">&#39;xy_exoplanar&#39;</span>
<span class="n">m2</span> <span class="o">=</span> <span class="s1">&#39;xy_middle&#39;</span>
<span class="n">m3</span> <span class="o">=</span> <span class="s1">&#39;xy_exofeatured&#39;</span>
<span class="n">m4</span> <span class="o">=</span> <span class="s1">&#39;xz_middle&#39;</span>
<span class="n">m5</span> <span class="o">=</span> <span class="s1">&#39;xz_edge&#39;</span>
<span class="n">m6</span> <span class="o">=</span> <span class="s1">&#39;yz_middle&#39;</span>
<span class="n">m7</span> <span class="o">=</span> <span class="s1">&#39;yz_edge&#39;</span>
</pre></div>
</div>
<p>We can acquire some required variables directly from the simulation data, and use these to define further necessary
variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xy_span</span> <span class="o">=</span> <span class="n">fdtd</span><span class="o">.</span><span class="n">getnamed</span><span class="p">(</span><span class="s2">&quot;structure::dielectric mediu&quot;</span><span class="p">,</span> <span class="s2">&quot;x span&quot;</span><span class="p">)</span>
<span class="n">wlen</span> <span class="o">=</span> <span class="n">fdtd</span><span class="o">.</span><span class="n">getnamed</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="s2">&quot;center wavelength&quot;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">fdtd</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">fdtd</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">fdtd</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">m4</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>

<span class="n">x_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>     <span class="c1"># Points in the axis</span>
<span class="n">z_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

<span class="n">x_res</span> <span class="o">=</span> <span class="n">xy_span</span><span class="o">/</span><span class="n">x_pts</span> <span class="c1"># resolution of simulation region</span>
<span class="n">midpoint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x_pts</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">fdtd</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">))</span> <span class="c1">#Gets frequency data and removes singleton dimensions</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="n">f</span>
</pre></div>
</div>
<p>The first thing we will calculate is the quality factor. to do this, we must first define a range of wavelengths
over which to search for the peak centre frequency and bandwidth:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### Define the freq ROI for the peak interested ####</span>

<span class="n">max_wlen</span> <span class="o">=</span> <span class="mf">638.0</span><span class="o">*</span><span class="mf">1e-09</span>
<span class="n">min_wlen</span> <span class="o">=</span> <span class="mf">630.0</span><span class="o">*</span><span class="mf">1e-09</span>

<span class="n">max_wlen</span> <span class="o">=</span> <span class="n">fdtd</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">max_wlen</span><span class="p">)</span>
<span class="n">min_wlen</span> <span class="o">=</span> <span class="n">fdtd</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="n">min_wlen</span><span class="p">)</span>
<span class="n">w_range_max</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">min_wlen</span>
<span class="n">w_range_min</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">max_wlen</span>
<span class="n">f_range_max</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="n">min_wlen</span>
<span class="n">f_range_min</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="n">max_wlen</span>
</pre></div>
</div>
<p>Now, we can call the cavityanalysis class, and instantiate the QFactor method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cavana</span> <span class="o">=</span> <span class="n">cavityanalysis</span><span class="o">.</span><span class="n">CavityAnalysis</span><span class="p">(</span><span class="n">fdtd</span><span class="o">=</span><span class="n">fdtd</span><span class="p">)</span>
<span class="n">cavana</span><span class="o">.</span><span class="n">Qfactor</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PyLumerical</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Gareth Sion Jones.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/examples_old.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>